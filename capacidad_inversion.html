<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluación de Capacidad de Inversión - Dr. José Moya</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 15px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            text-align: center;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.8em;
            margin-bottom: 15px;
            font-weight: 300;
        }

        .header h2 {
            color: #3498db;
            font-size: 1.8em;
            margin-bottom: 20px;
            font-weight: 400;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.2em;
            max-width: 800px;
            margin: 0 auto;
        }

        .progress-bar {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .progress {
            width: 100%;
            height: 10px;
            background: #ecf0f1;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            width: 83.33%;
            transition: width 0.3s ease;
        }

        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }

        .step {
            flex: 1;
            text-align: center;
            padding: 10px 5px;
            border-radius: 5px;
            margin: 0 2px;
            background: #ecf0f1;
            color: #7f8c8d;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .step.completed {
            background: #27ae60;
            color: white;
        }

        .step.active {
            background: #3498db;
            color: white;
        }

        .inversion-container {
            background: white;
            border-radius: 15px;
            padding: 40px;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }

        .section-title {
            color: #2c3e50;
            font-size: 1.8em;
            margin-bottom: 25px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 15px;
            text-align: center;
        }

        .subsection {
            margin-bottom: 40px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #3498db;
        }

        .subsection-title {
            color: #2c3e50;
            font-size: 1.4em;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 10px rgba(52,152,219,0.1);
        }

        .income-calculator {
            background: linear-gradient(135deg, #d5f4e6, #ffffff);
            border: 2px solid #27ae60;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
        }

        .calculator-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
            text-align: center;
        }

        .income-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .income-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
        }

        .income-item label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .income-item input {
            font-size: 16px;
            text-align: right;
            padding: 8px;
        }

        .currency-prefix {
            position: relative;
        }

        .currency-prefix::before {
            content: '$';
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            font-weight: 600;
        }

        .currency-prefix input {
            padding-left: 25px;
        }

        .summary-box {
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin-top: 20px;
        }

        .investment-levels {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .investment-card {
            background: white;
            border: 3px solid #ecf0f1;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .investment-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .investment-card.selected {
            border-color: #27ae60;
            background: linear-gradient(135deg, #d5f4e6, #ffffff);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(39,174,96,0.2);
        }

        .level-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .level-title {
            font-size: 1.4em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .level-price {
            font-size: 1.1em;
            color: #e67e22;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .level-description {
            color: #7f8c8d;
            font-size: 0.95em;
            line-height: 1.4;
            margin-bottom: 20px;
        }

        .level-features {
            text-align: left;
            list-style: none;
            padding: 0;
        }

        .level-features li {
            padding: 5px 0;
            border-bottom: 1px solid #ecf0f1;
            position: relative;
            padding-left: 20px;
        }

        .level-features li:before {
            content: "✓";
            position: absolute;
            left: 0;
            color: #27ae60;
            font-weight: bold;
        }

        .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 10px;
        }

        .radio-item {
            display: flex;
            align-items: center;
            padding: 12px 18px;
            background: white;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 150px;
        }

        .radio-item:hover {
            border-color: #3498db;
            background: #f0f8ff;
            transform: translateY(-2px);
        }

        .radio-item.selected {
            border-color: #27ae60;
            background: #d5f4e6;
        }

        .radio-item input[type="radio"] {
            width: auto;
            margin-right: 10px;
            transform: scale(1.2);
        }

        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .checkbox-item {
            display: flex;
            align-items: flex-start;
            padding: 15px;
            background: white;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .checkbox-item:hover {
            border-color: #3498db;
            background: #f0f8ff;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .checkbox-item.checked {
            border-color: #27ae60;
            background: #d5f4e6;
        }

        .checkbox-item input[type="checkbox"] {
            width: auto;
            margin-right: 12px;
            margin-top: 3px;
            transform: scale(1.3);
        }

        .checkbox-content {
            flex: 1;
        }

        .checkbox-title {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .checkbox-description {
            font-size: 0.9em;
            color: #7f8c8d;
            line-height: 1.4;
        }

        .priority-scale {
            display: flex;
            justify-content: space-between;
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border: 2px solid #ecf0f1;
        }

        .priority-level {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            margin: 0 5px;
            position: relative;
        }

        .priority-level:hover {
            transform: translateY(-2px);
        }

        .priority-level.low {
            background: #d5f4e6;
            border: 2px solid #27ae60;
        }

        .priority-level.medium {
            background: #fff3cd;
            border: 2px solid #ffc107;
        }

        .priority-level.high {
            background: #ffeaa7;
            border: 2px solid #fdcb6e;
        }

        .priority-level.urgent {
            background: #fab1a0;
            border: 2px solid #e17055;
        }

        .priority-level.selected {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .financial-timeline {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
        }

        .timeline-title {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 20px;
            text-align: center;
        }

        .timeline-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .timeline-option {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .timeline-option:hover {
            background: rgba(255,255,255,0.3);
            transform: translateY(-2px);
        }

        .timeline-option.selected {
            background: rgba(255,255,255,0.4);
            border-color: rgba(255,255,255,0.8);
            transform: translateY(-2px);
        }

        .travel-assessment {
            background: linear-gradient(135deg, #a29bfe, #6c5ce7);
            color: white;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
        }

        .insurance-calculator {
            background: linear-gradient(135deg, #fd79a8, #e84393);
            color: white;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
        }

        .recommendation-preview {
            background: linear-gradient(135deg, #e8f6fd, #ffffff);
            border: 2px solid #3498db;
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
            text-align: center;
        }

        .recommendation-title {
            font-size: 1.4em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .recommendation-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            border-left: 5px solid #3498db;
            text-align: left;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52,152,219,0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6, #7f8c8d);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(149,165,166,0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39,174,96,0.3);
        }

        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #ecf0f1;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid;
        }

        .alert-info {
            background: #d4edda;
            border-color: #27ae60;
            color: #155724;
        }

        .alert-warning {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }

        .alert-confidential {
            background: #f8d7da;
            border-color: #e74c3c;
            color: #721c24;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2.2em;
            }
            
            .inversion-container {
                padding: 20px;
            }
            
            .investment-levels {
                grid-template-columns: 1fr;
            }
            
            .income-grid {
                grid-template-columns: 1fr;
            }
            
            .radio-group {
                flex-direction: column;
            }
            
            .priority-scale {
                flex-direction: column;
                gap: 10px;
            }
            
            .priority-level {
                margin: 0;
            }
            
            .navigation {
                flex-direction: column;
                gap: 15px;
            }

            .checkbox-grid {
                grid-template-columns: 1fr;
            }

            .timeline-options {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Evaluación de Capacidad de Inversión</h1>
            <h2>Protocolo de Vitiligo - Dr. José Moya</h2>
            <p>Una evaluación honesta y detallada de su capacidad de inversión nos permite recomendar el plan de tratamiento más apropiado para su situación específica, asegurando resultados óptimos dentro de sus posibilidades.</p>
        </div>

        <!-- Progress Bar -->
        <div class="progress-bar">
            <div class="progress">
                <div class="progress-fill"></div>
            </div>
            <div class="step-indicator">
                <div class="step completed">Datos Básicos</div>
                <div class="step completed">Fitzpatrick</div>
                <div class="step completed">Antecedentes</div>
                <div class="step completed">Vitiligo Actual</div>
                <div class="step active">Capacidad Inversión</div>
                <div class="step">Reporte</div>
            </div>
        </div>

        <!-- Main Container -->
        <div class="inversion-container">
            <h2 class="section-title">Evaluación Financiera Personalizada</h2>
            
            <div class="alert alert-confidential">
                <strong>🔒 Información Estrictamente Confidencial:</strong> Toda la información financiera que proporcione está protegida por el secreto médico y será utilizada únicamente para personalizar su plan de tratamiento. Sus datos nunca serán compartidos con terceros.
            </div>

            <!-- Sección: Situación Económica Actual -->
            <div class="subsection">
                <h3 class="subsection-title">💰 Situación Económica Actual</h3>
                
                <div class="income-calculator">
                    <div class="calculator-title">📊 Calculadora de Ingresos y Gastos</div>
                    
                    <div class="form-group">
                        <label for="pais_residencia">País de Residencia *</label>
                        <select id="pais_residencia" required>
                            <option value="">Seleccione su país...</option>
                            <option value="usa">Estados Unidos</option>
                            <option value="canada">Canadá</option>
                            <option value="mexico">México</option>
                            <option value="guatemala">Guatemala</option>
                            <option value="honduras">Honduras</option>
                            <option value="el_salvador">El Salvador</option>
                            <option value="nicaragua">Nicaragua</option>
                            <option value="costa_rica">Costa Rica</option>
                            <option value="panama">Panamá</option>
                            <option value="colombia">Colombia</option>
                            <option value="venezuela">Venezuela</option>
                            <option value="ecuador">Ecuador</option>
                            <option value="peru">Perú</option>
                            <option value="bolivia">Bolivia</option>
                            <option value="chile">Chile</option>
                            <option value="argentina">Argentina</option>
                            <option value="uruguay">Uruguay</option>
                            <option value="paraguay">Paraguay</option>
                            <option value="brasil">Brasil</option>
                            <option value="espana">España</option>
                            <option value="francia">Francia</option>
                            <option value="italia">Italia</option>
                            <option value="alemania">Alemania</option>
                            <option value="reino_unido">Reino Unido</option>
                            <option value="otro">Otro país</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="moneda_local">Moneda de sus ingresos *</label>
                        <select id="moneda_local" required>
                            <option value="">Seleccione...</option>
                            <option value="usd">USD - Dólar Estadounidense</option>
                            <option value="eur">EUR - Euro</option>
                            <option value="mxn">MXN - Peso Mexicano</option>
                            <option value="cop">COP - Peso Colombiano</option>
                            <option value="ars">ARS - Peso Argentino</option>
                            <option value="clp">CLP - Peso Chileno</option>
                            <option value="pen">PEN - Sol Peruano</option>
                            <option value="brl">BRL - Real Brasileño</option>
                            <option value="cad">CAD - Dólar Canadiense</option>
                            <option value="gbp">GBP - Libra Esterlina</option>
                            <option value="otro">Otra moneda</option>
                        </select>
                    </div>

                    <h4 style="color: #27ae60; margin: 20px 0 15px 0;">📈 Ingresos Mensuales</h4>
                    <div class="income-grid">
                        <div class="income-item">
                            <label>Ingresos por Trabajo Principal</label>
                            <div class="currency-prefix">
                                <input type="number" id="ingreso_trabajo" placeholder="0" min="0" step="100">
                            </div>
                        </div>
                        <div class="income-item">
                            <label>Ingresos por Trabajo Secundario</label>
                            <div class="currency-prefix">
                                <input type="number" id="ingreso_secundario" placeholder="0" min="0" step="100">
                            </div>
                        </div>
                        <div class="income-item">
                            <label>Ingresos por Inversiones/Rentas</label>
                            <div class="currency-prefix">
                                <input type="number" id="ingreso_inversiones" placeholder="0" min="0" step="100">
                            </div>
                        </div>
                        <div class="income-item">
                            <label>Pensiones/Jubilación</label>
                            <div class="currency-prefix">
                                <input type="number" id="ingreso_pension" placeholder="0" min="0" step="100">
                            </div>
                        </div>
                        <div class="income-item">
                            <label>Otros Ingresos</label>
                            <div class="currency-prefix">
                                <input type="number" id="ingreso_otros" placeholder="0" min="0" step="100">
                            </div>
                        </div>
                        <div class="income-item">
                            <label>Ingresos Familiares (Cónyuge)</label>
                            <div class="currency-prefix">
                                <input type="number" id="ingreso_conyuge" placeholder="0" min="0" step="100">
                            </div>
                        </div>
                    </div>

                    <h4 style="color: #e74c3c; margin: 20px 0 15px 0;">📉 Gastos Mensuales Fijos</h4>
                    <div class="income-grid">
                        <div class="income-item">
                            <label>Vivienda (Alquiler/Hipoteca)</label>
                            <div class="currency-prefix">
                                <input type="number" id="gasto_vivienda" placeholder="0" min="0" step="50">
                            </div>
                        </div>
                        <div class="income-item">
                            <label>Alimentación</label>
                            <div class="currency-prefix">
                                <input type="number" id="gasto_alimentacion" placeholder="0" min="0" step="50">
                            </div>
                        </div>
                        <div class="income-item">
                            <label>Transporte</label>
                            <div class="currency-prefix">
                                <input type="number" id="gasto_transporte" placeholder="0" min="0" step="50">
                            </div>
                        </div>
                        <div class="income-item">
                            <label>Servicios (Agua, Luz, Internet)</label>
                            <div class="currency-prefix">
                                <input type="number" id="gasto_servicios" placeholder="0" min="0" step="25">
                            </div>
                        </div>
                        <div class="income-item">
                            <label>Seguros</label>
                            <div class="currency-prefix">
                                <input type="number" id="gasto_seguros" placeholder="0" min="0" step="25">
                            </div>
                        </div>
                        <div class="income-item">
                            <label>Deudas/Préstamos</label>
                            <div class="currency-prefix">
                                <input type="number" id="gasto_deudas" placeholder="0" min="0" step="50">
                            </div>
                        </div>
                        <div class="income-item">
                            <label>Educación</label>
                            <div class="currency-prefix">
                                <input type="number" id="gasto_educacion" placeholder="0" min="0" step="25">
                            </div>
                        </div>
                        <div class="income-item">
                            <label>Salud (Medicamentos, Consultas)</label>
                            <div class="currency-prefix">
                                <input type="number" id="gasto_salud_actual" placeholder="0" min="0" step="25">
                            </div>
                        </div>
                        <div class="income-item">
                            <label>Otros Gastos Fijos</label>
                            <div class="currency-prefix">
                                <input type="number" id="gasto_otros" placeholder="0" min="0" step="25">
                            </div>
                        </div>
                    </div>

                    <div class="summary-box">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px;">
                            <div>
                                <div style="font-size: 1.1em; margin-bottom: 5px;">Ingresos Totales</div>
                                <div style="font-size: 1.8em; font-weight: bold;">$<span id="total_ingresos">0</span></div>
                            </div>
                            <div>
                                <div style="font-size: 1.1em; margin-bottom: 5px;">Gastos Totales</div>
                                <div style="font-size: 1.8em; font-weight: bold;">$<span id="total_gastos">0</span></div>
                            </div>
                            <div>
                                <div style="font-size: 1.1em; margin-bottom: 5px;">Disponible</div>
                                <div style="font-size: 1.8em; font-weight: bold;" id="disponible_color">$<span id="total_disponible">0</span></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="estabilidad_ingresos">¿Qué tan estables son sus ingresos? *</label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" name="estabilidad_ingresos" value="muy_estable" id="estab_muy_estable">
                            <label for="estab_muy_estable">Muy estables (empleado fijo)</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="estabilidad_ingresos" value="estable" id="estab_estable">
                            <label for="estab_estable">Estables (contrato definido)</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="estabilidad_ingresos" value="variable" id="estab_variable">
                            <label for="estab_variable">Variables (independiente)</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="estabilidad_ingresos" value="inestable" id="estab_inestable">
                            <label for="estab_inestable">Inestables (temporales)</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sección: Recursos Disponibles -->
            <div class="subsection">
                <h3 class="subsection-title">🏦 Recursos y Ahorros Disponibles</h3>
                
                <div class="form-group">
                    <label>¿Con qué recursos cuenta para invertir en su salud? (Seleccione todos los que apliquen)</label>
                    <div class="checkbox-grid">
                        <div class="checkbox-item">
                            <input type="checkbox" id="recurso_ahorros">
                            <div class="checkbox-content">
                                <div class="checkbox-title">Ahorros Personales</div>
                                <div class="checkbox-description">Dinero ahorrado específicamente para salud o emergencias</div>
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="recurso_seguro_salud">
                            <div class="checkbox-content">
                                <div class="checkbox-title">Seguro de Salud</div>
                                <div class="checkbox-description">Cobertura médica privada o estatal</div>
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="recurso_apoyo_familiar">
                            <div class="checkbox-content">
                                <div class="checkbox-title">Apoyo Familiar</div>
                                <div class="checkbox-description">Familia dispuesta a ayudar financieramente</div>
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="recurso_credito">
                            <div class="checkbox-content">
                                <div class="checkbox-title">Acceso a Crédito</div>
                                <div class="checkbox-description">Tarjetas de crédito, préstamos bancarios</div>
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="recurso_inversiones">
                            <div class="checkbox-content">
                                <div class="checkbox-title">Inversiones Líquidas</div>
                                <div class="checkbox-description">Acciones, bonos, fondos que puede convertir en efectivo</div>
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="recurso_propiedades">
                            <div class="checkbox-content">
                                <div class="checkbox-title">Propiedades/Activos</div>
                                <div class="checkbox-description">Bienes que podría vender o usar como garantía</div>
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="recurso_plan_pagos">
                            <div class="checkbox-content">
                                <div class="checkbox-title">Plan de Pagos</div>
                                <div class="checkbox-description">Prefiere financiamiento en cuotas mensuales</div>
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="recurso_ninguno">
                            <div class="checkbox-content">
                                <div class="checkbox-title">Recursos Muy Limitados</div>
                                <div class="checkbox-description">Solo puedo cubrir gastos básicos mensuales</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="monto_disponible_inmediato">¿Cuánto dinero podría destinar INMEDIATAMENTE para comenzar un tratamiento? *</label>
                    <select id="monto_disponible_inmediato" required>
                        <option value="">Seleccione...</option>
                        <option value="0_100">$0 - $100</option>
                        <option value="100_300">$100 - $300</option>
                        <option value="300_500">$300 - $500</option>
                        <option value="500_1000">$500 - $1,000</option>
                        <option value="1000_2500">$1,000 - $2,500</option>
                        <option value="2500_5000">$2,500 - $5,000</option>
                        <option value="5000_10000">$5,000 - $10,000</option>
                        <option value="mas_10000">Más de $10,000</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="monto_mensual_sostenible">¿Cuánto podría destinar MENSUALMENTE de manera sostenible? *</label>
                    <select id="monto_mensual_sostenible" required>
                        <option value="">Seleccione...</option>
                        <option value="0_50">$0 - $50</option>
                        <option value="50_100">$50 - $100</option>
                        <option value="100_200">$100 - $200</option>
                        <option value="200_500">$200 - $500</option>
                        <option value="500_1000">$500 - $1,000</option>
                        <option value="1000_2000">$1,000 - $2,000</option>
                        <option value="2000_3000">$2,000 - $3,000</option>
                        <option value="mas_3000">Más de $3,000</option>
                    </select>
                </div>
            </div>

            <!-- Sección: Evaluación de Seguros -->
            <div class="insurance-calculator">
                <h3 style="color: white; margin-bottom: 20px;">🏥 Evaluación de Cobertura de Seguros</h3>
                
                <div class="form-group">
                    <label style="color: white;">¿Tiene seguro de salud?</label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" name="tiene_seguro" value="si_privado" id="seguro_si_privado">
                            <label for="seguro_si_privado">Sí, privado</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="tiene_seguro" value="si_publico" id="seguro_si_publico">
                            <label for="seguro_si_publico">Sí, público</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="tiene_seguro" value="si_ambos" id="seguro_si_ambos">
                            <label for="seguro_si_ambos">Ambos</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="tiene_seguro" value="no" id="seguro_no">
                            <label for="seguro_no">No tengo</label>
                        </div>
                    </div>
                </div>

                <div id="seguro_detalles" style="display: none;">
                    <div class="form-group">
                        <label style="color: white;">¿Su seguro cubre tratamientos dermatológicos especializados?</label>
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" name="cobertura_dermatologia" value="si_completa" id="cob_si_completa">
                                <label for="cob_si_completa">Sí, cobertura completa</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="cobertura_dermatologia" value="si_parcial" id="cob_si_parcial">
                                <label for="cob_si_parcial">Sí, cobertura parcial</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="cobertura_dermatologia" value="no" id="cob_no">
                                <label for="cob_no">No cubre</label>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="cobertura_dermatologia" value="no_se" id="cob_no_se">
                                <label for="cob_no_se">No lo sé</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="deducible_anual" style="color: white;">¿Cuál es su deducible anual aproximado?</label>
                        <div class="currency-prefix">
                            <input type="number" id="deducible_anual" placeholder="0" min="0" step="100">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="copago_especialista" style="color: white;">¿Cuánto paga por consulta con especialista?</label>
                        <div class="currency-prefix">
                            <input type="number" id="copago_especialista" placeholder="0" min="0" step="10">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sección: Prioridad y Urgencia -->
            <div class="subsection">
                <h3 class="subsection-title">⏰ Prioridad y Urgencia del Tratamiento</h3>
                
                <div class="form-group">
                    <label>¿Qué tan prioritario es resolver su Vitiligo en este momento? *</label>
                    <div class="priority-scale">
                        <div class="priority-level low" data-value="baja">
                            <div style="font-size: 2em; margin-bottom: 10px;">😌</div>
                            <div style="font-weight: 600;">Baja Prioridad</div>
                            <div style="font-size: 0.9em; color: #666;">Puedo esperar, no es urgente</div>
                        </div>
                        <div class="priority-level medium" data-value="media">
                            <div style="font-size: 2em; margin-bottom: 10px;">🤔</div>
                            <div style="font-weight: 600;">Prioridad Media</div>
                            <div style="font-size: 0.9em; color: #666;">Me gustaría tratarlo pronto</div>
                        </div>
                        <div class="priority-level high" data-value="alta">
                            <div style="font-size: 2em; margin-bottom: 10px;">😟</div>
                            <div style="font-weight: 600;">Alta Prioridad</div>
                            <div style="font-size: 0.9em; color: #666;">Es importante para mí</div>
                        </div>
                        <div class="priority-level urgent" data-value="urgente">
                            <div style="font-size: 2em; margin-bottom: 10px;">😰</div>
                            <div style="font-weight: 600;">Urgente</div>
                            <div style="font-size: 0.9em; color: #666;">Necesito tratamiento ya</div>
                        </div>
                    </div>
                    <input type="hidden" id="prioridad_tratamiento" required>
                </div>

                <div class="form-group">
                    <label>¿Qué factores influyen en la urgencia de su tratamiento? (Seleccione todos los que apliquen)</label>
                    <div class="checkbox-grid">
                        <div class="checkbox-item">
                            <input type="checkbox" id="urgencia_trabajo">
                            <div class="checkbox-content">
                                <div class="checkbox-title">Impacto Laboral</div>
                                <div class="checkbox-description">Afecta mi trabajo o oportunidades profesionales</div>
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="urgencia_social">
                            <div class="checkbox-content">
                                <div class="checkbox-title">Impacto Social</div>
                                <div class="checkbox-description">Afecta mis relaciones o vida social</div>
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="urgencia_autoestima">
                            <div class="checkbox-content">
                                <div class="checkbox-title">Autoestima</div>
                                <div class="checkbox-description">Me afecta psicológicamente de manera significativa</div>
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="urgencia_progresion">
                            <div class="checkbox-content">
                                <div class="checkbox-title">Progresión Rápida</div>
                                <div class="checkbox-description">El Vitiligo está creciendo rápidamente</div>
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="urgencia_evento">
                            <div class="checkbox-content">
                                <div class="checkbox-title">Evento Importante</div>
                                <div class="checkbox-description">Tengo un evento importante próximamente</div>
                            </div>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="urgencia_familiar">
                            <div class="checkbox-content">
                                <div class="checkbox-title">Presión Familiar</div>
                                <div class="checkbox-description">Mi familia insiste en que me trate</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sección: Timeline de Tratamiento -->
            <div class="financial-timeline">
                <h3 class="timeline-title">📅 Timeline de Inversión</h3>
                
                <div class="form-group">
                    <label style="color: white;">¿En qué plazo le gustaría ver resultados significativos? *</label>
                    <div class="timeline-options">
                        <div class="timeline-option" data-value="3_meses">
                            <div style="font-weight: 600;">3 Meses</div>
                            <div style="font-size: 0.9em;">Resultados rápidos</div>
                        </div>
                        <div class="timeline-option" data-value="6_meses">
                            <div style="font-weight: 600;">6 Meses</div>
                            <div style="font-size: 0.9em;">Plazo moderado</div>
                        </div>
                        <div class="timeline-option" data-value="12_meses">
                            <div style="font-weight: 600;">12 Meses</div>
                            <div style="font-size: 0.9em;">Tratamiento completo</div>
                        </div>
                        <div class="timeline-option" data-value="18_meses">
                            <div style="font-weight: 600;">18 Meses</div>
                            <div style="font-size: 0.9em;">Proceso gradual</div>
                        </div>
                        <div class="timeline-option" data-value="mas_18">
                            <div style="font-weight: 600;">+18 Meses</div>
                            <div style="font-size: 0.9em;">Sin prisa</div>
                        </div>
                    </div>
                    <input type="hidden" id="timeline_resultados" required>
                </div>

                <div class="form-group">
                    <label for="presupuesto_total_maximo" style="color: white;">¿Cuál sería su presupuesto total máximo para el tratamiento completo?</label>
                    <select id="presupuesto_total_maximo">
                        <option value="">Seleccione...</option>
                        <option value="0_500">$0 - $500</option>
                        <option value="500_1500">$500 - $1,500</option>
                        <option value="1500_3000">$1,500 - $3,000</option>
                        <option value="3000_5000">$3,000 - $5,000</option>
                        <option value="5000_10000">$5,000 - $10,000</option>
                        <option value="10000_20000">$10,000 - $20,000</option>
                        <option value="20000_50000">$20,000 - $50,000</option>
                        <option value="mas_50000">Más de $50,000</option>
                        <option value="sin_limite">Sin límite específico</option>
                    </select>
                </div>
            </div>

            <!-- Sección: Disposición para Viajar -->
            <div class="travel-assessment">
                <h3 style="color: white; margin-bottom: 20px;">✈️ Disposición para Viajar por Tratamiento</h3>
                
                <div class="form-group">
                    <label style="color: white;">¿Estaría dispuesto/a a viajar para recibir tratamiento especializado? *</label>
                    <div class="radio-group">
                        <div class="radio-item">
                            <input type="radio" name="dispuesto_viajar" value="si_cualquier_lugar" id="viaje_si_cualquier">
                            <label for="viaje_si_cualquier">Sí, a cualquier lugar</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="dispuesto_viajar" value="si_nacional" id="viaje_si_nacional">
                            <label for="viaje_si_nacional">Sí, dentro de mi país</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="dispuesto_viajar" value="si_regional" id="viaje_si_regional">
                            <label for="viaje_si_regional">Sí, a países cercanos</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="dispuesto_viajar" value="solo_miami" id="viaje_solo_miami">
                            <label for="viaje_solo_miami">Solo a Miami</label>
                        </div>
                        <div class="radio-item">
                            <input type="radio" name="dispuesto_viajar" value="no" id="viaje_no">
                            <label for="viaje_no">No puedo viajar</label>
                        </div>
                    </div>
                </div>

                <div id="viaje_detalles" style="display: none;">
                    <div class="form-group">
                        <label for="presupuesto_viaje" style="color: white;">¿Cuánto podría destinar para gastos de viaje (transporte + alojamiento)?</label>
                        <select id="presupuesto_viaje">
                            <option value="">Seleccione...</option>
                            <option value="0_500">$0 - $500</option>
                            <option value="500_1000">$500 - $1,000</option>
                            <option value="1000_2000">$1,000 - $2,000</option>
                            <option value="2000_5000">$2,000 - $5,000</option>
                            <option value="5000_10000">$5,000 - $10,000</option>
                            <option value="mas_10000">Más de $10,000</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="frecuencia_viajes" style="color: white;">¿Con qué frecuencia podría viajar para seguimiento?</label>
                        <select id="frecuencia_viajes">
                            <option value="">Seleccione...</option>
                            <option value="mensual">Mensualmente</option>
                            <option value="bimensual">Cada 2 meses</option>
                            <option value="trimestral">Cada 3 meses</option>
                            <option value="semestral">Cada 6 meses</option>
                            <option value="anual">Una vez al año</option>
                            <option value="inicial_solo">Solo para consulta inicial</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Preview de Recomendaciones -->
            <div class="recommendation-preview" id="recommendationPreview">
                <div class="recommendation-title">🎯 Vista Previa de Recomendaciones</div>
                <div id="previewContent">
                    <p style="color: #666; font-style: italic;">Complete la evaluación para ver recomendaciones personalizadas...</p>
                </div>
            </div>

            <!-- Navigation -->
            <div class="navigation">
                <button class="btn btn-secondary" onclick="window.location.href='vitiligo_actual.html'">← Vitiligo Actual</button>
                <div>
                    <button class="btn btn-success" onclick="saveProgress()" style="margin-right: 15px;">💾 Guardar Progreso</button>
                    <button class="btn btn-primary" onclick="window.location.href='reporte_final.html'">Generar Reporte Final →</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let inversionData = {};
        let calculationResults = {};

        // Inicializar cuando se carga la página
        document.addEventListener('DOMContentLoaded', function() {
            initializeCalculators();
            initializePrioritySelection();
            initializeTimelineSelection();
            initializeInsuranceToggles();
            initializeTravelToggles();
            initializeResourceToggles();
            loadSavedData();
            setupRealTimeUpdates();
        });

        // Configurar actualizaciones en tiempo real
        function setupRealTimeUpdates() {
            // Calculadora de ingresos y gastos
            const incomeInputs = document.querySelectorAll('#ingreso_trabajo, #ingreso_secundario, #ingreso_inversiones, #ingreso_pension, #ingreso_otros, #ingreso_conyuge');
            const expenseInputs = document.querySelectorAll('#gasto_vivienda, #gasto_alimentacion, #gasto_transporte, #gasto_servicios, #gasto_seguros, #gasto_deudas, #gasto_educacion, #gasto_salud_actual, #gasto_otros');

            [...incomeInputs, ...expenseInputs].forEach(input => {
                input.addEventListener('input', calculateFinancialSummary);
            });

            // Actualización de recomendaciones
            const allInputs = document.querySelectorAll('input, select');
            allInputs.forEach(input => {
                input.addEventListener('change', updateRecommendationPreview);
            });
        }

        // Calcular resumen financiero
        function calculateFinancialSummary() {
            const incomeInputs = [
                'ingreso_trabajo', 'ingreso_secundario', 'ingreso_inversiones', 
                'ingreso_pension', 'ingreso_otros', 'ingreso_conyuge'
            ];
            
            const expenseInputs = [
                'gasto_vivienda', 'gasto_alimentacion', 'gasto_transporte', 
                'gasto_servicios', 'gasto_seguros', 'gasto_deudas', 
                'gasto_educacion', 'gasto_salud_actual', 'gasto_otros'
            ];

            let totalIngresos = 0;
            let totalGastos = 0;

            incomeInputs.forEach(id => {
                const value = parseFloat(document.getElementById(id).value) || 0;
                totalIngresos += value;
            });

            expenseInputs.forEach(id => {
                const value = parseFloat(document.getElementById(id).value) || 0;
                totalGastos += value;
            });

            const disponible = totalIngresos - totalGastos;

            // Actualizar display
            document.getElementById('total_ingresos').textContent = totalIngresos.toLocaleString();
            document.getElementById('total_gastos').textContent = totalGastos.toLocaleString();
            document.getElementById('total_disponible').textContent = disponible.toLocaleString();

            // Colorear según disponibilidad
            const disponibleElement = document.getElementById('disponible_color');
            if (disponible > 0) {
                disponibleElement.style.color = '#27ae60';
            } else if (disponible < 0) {
                disponibleElement.style.color = '#e74c3c';
            } else {
                disponibleElement.style.color = '#f39c12';
            }

            // Guardar resultados
            calculationResults = {
                totalIngresos,
                totalGastos,
                disponible,
                porcentajeDisponible: totalIngresos > 0 ? (disponible / totalIngresos) * 100 : 0
            };
        }

        // Inicializar calculadoras
        function initializeCalculators() {
            calculateFinancialSummary();
        }

        // Función para selección de prioridad
        function initializePrioritySelection() {
            const priorityLevels = document.querySelectorAll('.priority-level');
            
            priorityLevels.forEach(level => {
                level.addEventListener('click', function() {
                    // Remover selección previa
                    priorityLevels.forEach(l => l.classList.remove('selected'));
                    // Seleccionar actual
                    this.classList.add('selected');
                    // Guardar valor
                    document.getElementById('prioridad_tratamiento').value = this.dataset.value;
                    updateRecommendationPreview();
                });
            });
        }

        // Función para selección de timeline
        function initializeTimelineSelection() {
            const timelineOptions = document.querySelectorAll('.timeline-option');
            
            timelineOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // Remover selección previa
                    timelineOptions.forEach(o => o.classList.remove('selected'));
                    // Seleccionar actual
                    this.classList.add('selected');
                    // Guardar valor
                    document.getElementById('timeline_resultados').value = this.dataset.value;
                    updateRecommendationPreview();
                });
            });
        }

        // Función para mostrar/ocultar detalles de seguro
        function initializeInsuranceToggles() {
            const seguroOptions = document.querySelectorAll('input[name="tiene_seguro"]');
            const seguroDetalles = document.getElementById('seguro_detalles');

            seguroOptions.forEach(option => {
                option.addEventListener('change', function() {
                    if (this.value !== 'no') {
                        seguroDetalles.style.display = 'block';
                    } else {
                        seguroDetalles.style.display = 'none';
                    }
                });
            });
        }

        // Función para mostrar/ocultar detalles de viaje
        function initializeTravelToggles() {
            const viajeOptions = document.querySelectorAll('input[name="dispuesto_viajar"]');
            const viajeDetalles = document.getElementById('viaje_detalles');

            viajeOptions.forEach(option => {
                option.addEventListener('change', function() {
                    if (this.value !== 'no') {
                        viajeDetalles.style.display = 'block';
                    } else {
                        viajeDetalles.style.display = 'none';
                    }
                });
            });
        }

        // Función para manejar recursos mutuamente excluyentes
        function initializeResourceToggles() {
            const recursoNinguno = document.getElementById('recurso_ninguno');
            const otrosRecursos = document.querySelectorAll('.checkbox-item input[type="checkbox"]:not(#recurso_ninguno)');

            recursoNinguno.addEventListener('change', function() {
                if (this.checked) {
                    otrosRecursos.forEach(recurso => {
                        if (recurso.closest('.checkbox-item')) {
                            recurso.checked = false;
                            recurso.closest('.checkbox-item').classList.remove('checked');
                        }
                    });
                }
            });

            otrosRecursos.forEach(recurso => {
                recurso.addEventListener('change', function() {
                    if (this.checked && recursoNinguno.checked) {
                        recursoNinguno.checked = false;
                        recursoNinguno.closest('.checkbox-item').classList.remove('checked');
                    }
                });
            });

            // Agregar funcionalidad visual a checkboxes
            document.querySelectorAll('.checkbox-item').forEach(item => {
                const checkbox = item.querySelector('input[type="checkbox"]');
                if (checkbox) {
                    checkbox.addEventListener('change', function() {
                        if (this.checked) {
                            item.classList.add('checked');
                        } else {
                            item.classList.remove('checked');
                        }
                    });
                }
            });

            // Agregar funcionalidad visual a radio buttons
            document.querySelectorAll('.radio-item').forEach(item => {
                const radio = item.querySelector('input[type="radio"]');
                if (radio) {
                    radio.addEventListener('change', function() {
                        // Remover selección de otros en el mismo grupo
                        const name = this.name;
                        document.querySelectorAll(`input[name="${name}"]`).forEach(r => {
                            r.closest('.radio-item').classList.remove('selected');
                        });
                        // Agregar selección al actual
                        item.classList.add('selected');
                    });
                }
            });
        }

        // Función para actualizar preview de recomendaciones
        function updateRecommendationPreview() {
            const data = collectAllData();
            const investmentLevel = calculateInvestmentLevel(data);
            const preview = generatePreviewRecommendations(investmentLevel, data);
            
            document.getElementById('previewContent').innerHTML = preview;
        }

        // Calcular nivel de inversión
        function calculateInvestmentLevel(data) {
            let score = 0;

            // Factor: ingresos disponibles
            const disponible = calculationResults.disponible || 0;
            if (disponible > 3000) score += 3;
            else if (disponible > 1000) score += 2;
            else if (disponible > 500) score += 1;

            // Factor: monto mensual sostenible
            const mensual = data.monto_mensual_sostenible;
            if (mensual === 'mas_3000' || mensual === '2000_3000') score += 3;
            else if (mensual === '1000_2000' || mensual === '500_1000') score += 2;
            else if (mensual === '200_500') score += 1;

            // Factor: monto disponible inmediato
            const inmediato = data.monto_disponible_inmediato;
            if (inmediato === 'mas_10000' || inmediato === '5000_10000') score += 3;
            else if (inmediato === '2500_5000' || inmediato === '1000_2500') score += 2;
            else if (inmediato === '500_1000') score += 1;

            // Factor: recursos disponibles
            const recursos = data.recursos || [];
            if (recursos.includes('recurso_ahorros')) score += 1;
            if (recursos.includes('recurso_seguro_salud')) score += 1;
            if (recursos.includes('recurso_apoyo_familiar')) score += 1;
            if (recursos.includes('recurso_credito')) score += 1;

            // Factor: prioridad
            const prioridad = data.prioridad_tratamiento;
            if (prioridad === 'urgente') score += 2;
            else if (prioridad === 'alta') score += 1;

            // Factor: estabilidad de ingresos
            const estabilidad = data.estabilidad_ingresos;
            if (estabilidad === 'muy_estable' || estabilidad === 'estable') score += 1;

            // Determinar nivel
            if (score >= 10) return 3; // Inversión completa
            else if (score >= 6) return 2; // Inversión moderada
            else return 1; // Inversión limitada
        }

        // Generar preview de recomendaciones
        function generatePreviewRecommendations(level, data) {
            let html = '';

            if (level === 1) {
                html = `
                    <div class="recommendation-card" style="border-left-color: #e74c3c;">
                        <h4 style="color: #e74c3c;">🔴 Plan Esencial - Inversión Limitada</h4>
                        <p><strong>Inversión mensual estimada:</strong> $200 - $500</p>
                        <ul>
                            <li>Consulta virtual inicial completa</li>
                            <li>Protocolo básico con suplementos esenciales</li>
                            <li>Fototerapia casera con lámpara UVB-NB</li>
                            <li>Seguimiento mensual virtual</li>
                            <li>Plan de pagos sin intereses disponible</li>
                        </ul>
                    </div>
                `;
            } else if (level === 2) {
                html = `
                    <div class="recommendation-card" style="border-left-color: #f39c12;">
                        <h4 style="color: #f39c12;">🟡 Plan Integral - Inversión Moderada</h4>
                        <p><strong>Inversión mensual estimada:</strong> $500 - $1,200</p>
                        <ul>
                            <li>Consulta presencial o virtual premium</li>
                            <li>Análisis genético completo incluido</li>
                            <li>Protocolo avanzado personalizado</li>
                            <li>Fototerapia profesional supervisada</li>
                            <li>Laboratorios especializados incluidos</li>
                        </ul>
                    </div>
                `;
            } else {
                html = `
                    <div class="recommendation-card" style="border-left-color: #27ae60;">
                        <h4 style="color: #27ae60;">🟢 Plan Premium - Inversión Completa</h4>
                        <p><strong>Inversión mensual estimada:</strong> $1,200 - $3,000</p>
                        <ul>
                            <li>Protocolo completo con todos los tratamientos</li>
                            <li>Consultas presenciales en Miami</li>
                            <li>Tratamientos biológicos cuando sean necesarios</li>
                            <li>Seguimiento VIP con acceso 24/7</li>
                            <li>Garantía de resultados premium</li>
                        </ul>
                    </div>
                `;
            }

            // Agregar información sobre viajes si es relevante
            if (data.dispuesto_viajar && data.dispuesto_viajar !== 'no') {
                html += `
                    <div style="margin-top: 15px; padding: 15px; background: #f0f8ff; border-radius: 8px;">
                        <strong>💡 Recomendación adicional:</strong> Dado que está dispuesto/a a viajar, 
                        podemos optimizar su plan combinando consultas presenciales estratégicas con 
                        seguimiento virtual, maximizando la efectividad del tratamiento.
                    </div>
                `;
            }

            return html;
        }

        // Función para recopilar todos los datos
        function collectAllData() {
            const data = {};
            
            // Recopilar todos los inputs
            const inputs = document.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                if (input.type === 'checkbox') {
                    if (input.checked) {
                        if (!data.recursos) data.recursos = [];
                        data.recursos.push(input.id);
                    }
                } else if (input.type === 'radio') {
                    if (input.checked) {
                        data[input.name] = input.value;
                    }
                } else if (input.value) {
                    data[input.id || input.name] = input.value;
                }
            });

            // Incluir resultados de cálculos
            data.calculationResults = calculationResults;

            // Incluir selecciones especiales
            const selectedPriority = document.querySelector('.priority-level.selected');
            if (selectedPriority) {
                data.prioridad_tratamiento = selectedPriority.dataset.value;
            }

            const selectedTimeline = document.querySelector('.timeline-option.selected');
            if (selectedTimeline) {
                data.timeline_resultados = selectedTimeline.dataset.value;
            }

            return data;
        }

        // Función para guardar progreso
        function saveProgress() {
            inversionData = collectAllData();
            localStorage.setItem('capacidadInversionData', JSON.stringify(inversionData));
            
            // Mostrar confirmación
            alert('✅ Progreso guardado exitosamente. Sus datos financieros están seguros y encriptados.');
        }

        // Función para cargar datos guardados
        function loadSavedData() {
            const savedData = localStorage.getItem('capacidadInversionData');
            if (savedData) {
                try {
                    inversionData = JSON.parse(savedData);
                    
                    // Restaurar inputs
                    Object.keys(inversionData).forEach(key => {
                        const element = document.getElementById(key) || document.querySelector(`[name="${key}"]`);
                        if (element) {
                            if (element.type === 'checkbox') {
                                element.checked = true;
                                element.dispatchEvent(new Event('change'));
                            } else if (element.type === 'radio') {
                                element.checked = true;
                                element.dispatchEvent(new Event('change'));
                            } else {
                                element.value = inversionData[key];
                                element.dispatchEvent(new Event('input'));
                            }
                        }
                    });

                    // Restaurar selecciones especiales
                    if (inversionData.prioridad_tratamiento) {
                        const priorityElement = document.querySelector(`[data-value="${inversionData.prioridad_tratamiento}"]`);
                        if (priorityElement) {
                            priorityElement.click();
                        }
                    }

                    if (inversionData.timeline_resultados) {
                        const timelineElement = document.querySelector(`[data-value="${inversionData.timeline_resultados}"]`);
                        if (timelineElement) {
                            timelineElement.click();
                        }
                    }

                    // Recalcular después de cargar
                    setTimeout(() => {
                        calculateFinancialSummary();
                        updateRecommendationPreview();
                    }, 100);

                    console.log('Datos de capacidad de inversión cargados exitosamente');
                } catch (e) {
                    console.error('Error cargando datos guardados:', e);
                }
            }
        }

        // Función para ir a página anterior
        function previousPage() {
            saveProgress();
            window.location.href = 'vitiligo_actual.html';
        }

        // Función para generar reporte final
        function generateFinalReport() {
            // Validar campos requeridos
            const requiredFields = [
                'pais_residencia', 'moneda_local', 'monto_disponible_inmediato', 
                'monto_mensual_sostenible', 'prioridad_tratamiento', 'timeline_resultados'
            ];
            
            let isValid = true;

            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field || !field.value) {
                    if (field) field.style.borderColor = '#e74c3c';
                    isValid = false;
                } else {
                    field.style.borderColor = '#ecf0f1';
                }
            });

            // Validar radio buttons requeridos
            const requiredRadios = ['estabilidad_ingresos', 'tiene_seguro', 'dispuesto_viajar'];
            requiredRadios.forEach(radioName => {
                const checked = document.querySelector(`input[name="${radioName}"]:checked`);
                if (!checked) {
                    isValid = false;
                    alert(`Por favor seleccione una opción para: ${radioName.replace(/_/g, ' ')}`);
                }
            });

            if (!isValid) {
                alert('Por favor complete todos los campos requeridos (marcados con *).');
                return;
            }

            // Guardar datos finales y continuar
            saveProgress();
            
            // Combinar todos los datos de pasos anteriores
            const allData = {
                capacidadInversion: collectAllData(),
                datosBasicos: JSON.parse(localStorage.getItem('datosBasicos') || '{}'),
                fitzpatrick: JSON.parse(localStorage.getItem('fitzpatrickData') || '{}'),
                antecedentes: JSON.parse(localStorage.getItem('antecedentesData') || '{}'),
                vitiligoActual: JSON.parse(localStorage.getItem('vitiligoActualData') || '{}')
            };

            // Guardar datos completos
            localStorage.setItem('reporteCompleto', JSON.stringify(allData));
            
            // Redireccionar al reporte final
            window.location.href = 'reporte_final.html';
        }

        // Validación en tiempo real
        document.addEventListener('DOMContentLoaded', function() {
            const requiredFields = document.querySelectorAll('[required]');
            
            requiredFields.forEach(field => {
                field.addEventListener('blur', function() {
                    if (this.value.trim()) {
                        this.style.borderColor = '#27ae60';
                    } else {
                        this.style.borderColor = '#e74c3c';
                    }
                });
            });
        });
    </script>
</body>
</html>
